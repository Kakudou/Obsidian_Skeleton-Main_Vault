---
Title: 'Daily Planner: <% tp.file.title %>'
Author: カクドウ ~ Kakudou
Tags: 

Template: DailyPlanner

Creation Date: <% tp.file.creation_date("YYYY/MM/DD HH:mm:ss") %>
Modification Date: <% tp.file.creation_date("YYYY/MM/DD HH:mm:ss") %>
---

# Daily Planner: <% tp.file.title %>

## Journal

<%*  
		try {  
				tR+= await tp.web.random_picture("200x200")  
		} catch (err) {  
				new Notice("Error: \n" + err , 2000);  
		}  
%>
<%*  
		try {  
				tR+= await tp.web.daily_quote()  
		} catch (err) {  
				new Notice("Error: \n" + err , 2000);  
		}  
%>

### Working Day

#### Morning

- [ ] <% tp.file.creation_date("HH:mm") %> Start Working Day #Planner/start

#### Lunch Break

- [ ] 12:30 Start Lunch Break #Planner/break
- [ ] 13:30 End Lunch Break #Planner/break

#### Afternoon

- [ ] 19:00 End Working Day #Planner/end

### Off Working Day

---

## Daily Bilan

```dataviewjs

let tasks = dv.current().file.lists.where(t => t.completed && t.tags.length > 0 ).map(t => [
Date.parse(new Date(0,0,0,t.text.match(/([0-9]{2}):([0-9]{2})/)[1], t.text.match(/([0-9]{2}):([0-9]{2})/)[2])),
t.tags[0].split('#')[1],
t.text.match(/[0-9]{2}:[0-9]{2}\ (.*)\ (#)?/)[1]
])

function milisecondsToHMS(miliseconds) {
  function z(n){return (n<10?'0':'') + n;}
  var sign = miliseconds < 0? '-':'';
  let secs = Math.abs(miliseconds/1000);
  return sign + z(secs/3600 |0) + 'h' + z((secs%3600) / 60 |0);
}

let msByTags = {}

var i = 0;
  while (i<tasks.length) {
  if ( i !=0 && i != tasks.length -1) {
      if (!msByTags[tasks[i][1]] ) {
        msByTags[tasks[i][1]] = {}
        msByTags[tasks[i][1]].tag = tasks[i][1]
        msByTags[tasks[i][1]].duration = (tasks[i+1][0] - tasks[i][0])
        msByTags[tasks[i][1]].details = [tasks[i][2]+" ~ "+milisecondsToHMS(tasks[i+1][0] - tasks[i][0])]
      } else {
        msByTags[tasks[i][1]].duration += (tasks[i+1][0] - tasks[i][0])
        msByTags[tasks[i][1]].details.push(tasks[i][2]+" ~ "+milisecondsToHMS(tasks[i+1][0] - tasks[i][0]))
      }
    }
    i++;
  }

let total = 0
let timeByTags = {}
for (let tag in msByTags){
  if (tag != "Planner/break"){
    timeByTags[tag] = {}
    total += msByTags[tag].duration
    timeByTags[tag].tag = tag
    timeByTags[tag].duration = milisecondsToHMS(msByTags[tag].duration)
    timeByTags[tag].details = msByTags[tag].details
  }
}

timeByTags["Total"] = {}
timeByTags["Total"].tag = "Planner/Total"
timeByTags["Total"].duration = milisecondsToHMS(total)

let table = dv.markdownTable(["Tags", "Durations", "Details"],
                            Object.values(timeByTags)
                            .sort(b => -b.duration)
                            .map(b => [b.tag.split('/')[1], b.duration, b.details])
                            )

dv.paragraph(table)
```

---

## Created Today

```dataviewjs
let currentDate = dv.current()["Creation Date"].split(" ")[0]

let currentDateCreate = dv.pages().where(f => f["Creation Date"] && f["Creation Date"].split(" ")[0] == currentDate)

let table = dv.markdownTable(["Link", "Created", "Last Modified"], currentDateCreate
  .sort(b => -b.file.ctime)
  .map(b => [ dv.fileLink(b.file.path, false, b.file.frontmatter["Title"]), b.file.frontmatter["Creation Date"], b.file.frontmatter["Modification Date"]]))

dv.paragraph(table)
```

---

## Last Modified Today

```dataviewjs
let currentDate = dv.current()["Creation Date"].split(" ")[0]

let currentDateModify = dv.pages().where(f => f["Modification Date"] && f["Modification Date"].split(" ")[0] == currentDate && f["Creation Date"].split(" ")[0] != currentDate)

let table = dv.markdownTable(["Link", "Created", "Last Modified"], currentDateModify
  .sort(b => -b.file.mtime)
  .map(b => [ dv.fileLink(b.file.path, false, b.file.frontmatter["Title"]), b.file.frontmatter["Creation Date"], b.file.frontmatter["Modification Date"]]))

dv.paragraph(table)
```
